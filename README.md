# node 应用爬虫部分

## 项目结构

### 后端的主要结构

后端主要由 node + koa + MongoDB 组成,先用 node 爬下数据,然后再存到 MongoDB 中,后续再从数据集中获取然后再传给前端,再用前端进行展示.

#### 函数及其作用

`/api/lianjia/xian` 获取西安的所有二手房数据,包括页面中的 3000 条数据
`/api/lianjia/chengdu` 获取成都的二手房数据,包括页面中的 3000 条数据
`/api/lianjia/city` 获取以省份为单位的二手房总数据,这里的数据结构是这样的 `{ province: '四川', cityEN: 'cd', cityCH: '成都',total:'23445', time:'Date'}`, 这样的数据结构只是为了做每日的图表用,基本上就是以日线和周线为主,月线到时候再看下吧,暂时不做为主要的进攻方向,基本上这里的展示角度会以每日的增长量,人口的数据维度下的比对,经济的数据维度下的比对,以及房的数据下的比对.
`/api/getxian` 获取已经存好的西安二手房数据
`/api/getchengdu` 获取已经存好的成都二手房数据
`/api/city` 获取已经存好的所有二手房数据,返回给前端做数据的展示用

#### 定时任务

这里的定时任务就用Node Schedule 来做,

    *    *    *    *    *    *
    ┬    ┬    ┬    ┬    ┬    ┬
    │    │    │    │    │    │
    │    │    │    │    │    └ day of week (0 - 7) (0 or 7 is Sun)
    │    │    │    │    └───── month (1 - 12)
    │    │    │    └────────── day of month (1 - 31)
    │    │    └─────────────── hour (0 - 23)
    │    └──────────────────── minute (0 - 59)
    └───────────────────────── second (0 - 59, OPTIONAL)

Node Schedule 及其强大的一点就是这个,可以通过 * 号位置的不同来设置不同等级的时间维度参数,这是非常强大的一点,我很喜欢,简单直白以及强大.这是官方的链接 [https://github.com/node-schedule/node-schedule](https://github.com/node-schedule/node-schedule)

### 前端主要结构

目前的想法是前端主要用 react 来实现,表格的部分用 antd 来做,基本上就是目前的这一套,只不过想用 TS 来实现前端的代码,这样的话用 ts 来练练手.至于数据的管理目前的想法是暂时不用 redux ,redux 太重了,暂时用自带的 hooks 来试试

#### 数据的展示

在这里数据的展示基本上就是以省为主,以城市的相互比对,经济的比对,以及房产的数据比对为主

#### 前端的请求库 fetch

首先是需要明白的地方就是 fetch 是不能直接被使用,要做个封装才可以,做成两个封装,一个是 post 和 get ,后续了看要不要加上 delete ,其实我个人是很不喜欢 delete ,这和用的不是很多有关系????具体的原因么可能和舒适区有关系,不喜欢用自己没怎么用的东西,今天把 fetch 先给做好,其余的先不说.
这里的 fetch.js 会导出两个对象,一个是 POST 一个是 GET,通过这两个对象进行后端数据的查询和传输.对 JS 的导出有点生疏了,这里再复习一下.具体的 fetch 的详细使用指南可以看下下面的这篇文章 [fetch使用指南](https://segmentfault.com/a/1190000007019545),这里采用的是第三种解决方案也是我司目前采用的解决方案,使用 Promise 来做.